<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ExGPT 4.0 Cloud - Premium</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        :root {
            --bg-color: #0d0d0d;
            --chat-bg: #121212;
            --text-color: #ececec;
            --accent-color: #00ff88; /* –ù–µ–æ–Ω–æ–≤—ã–π –∑–µ–ª–µ–Ω—ã–π –¥–ª—è —Å—Ç–∏–ª—è */
            --user-msg: #2b2d31;
        }
        body, html { margin: 0; padding: 0; height: 100%; font-family: 'Segoe UI', Roboto, sans-serif; background-color: var(--bg-color); color: var(--text-color); overflow: hidden; }
        
        /* –≠–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞ */
        #login-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle at center, #1a1a1a 0%, #000 100%); z-index: 5000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .login-box { background: rgba(255,255,255,0.05); backdrop-filter: blur(10px); padding: 40px; border-radius: 24px; border: 1px solid rgba(255,255,255,0.1); text-align: center; width: 85%; max-width: 380px; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
        .login-box input { width: 100%; padding: 14px; margin: 20px 0; border-radius: 12px; border: 1px solid #333; background: #000; color: white; box-sizing: border-box; outline: none; transition: 0.3s; }
        .login-box input:focus { border-color: var(--accent-color); box-shadow: 0 0 10px rgba(0,255,136,0.2); }

        #app { display: flex; flex-direction: column; height: 100vh; max-width: 1000px; margin: 0 auto; position: relative; background: var(--chat-bg); }
        header { padding: 18px; text-align: center; border-bottom: 1px solid #222; font-weight: 700; letter-spacing: 1px; background: rgba(0,0,0,0.3); }
        
        #chat-window { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 22px; }
        .msg-row { display: flex; gap: 12px; width: 100%; animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .user-row { flex-direction: row-reverse; }
        .system-row { justify-content: center; }
        .avatar { width: 38px; height: 38px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: bold; background: #333; flex-shrink: 0; font-size: 14px; color: #fff; }
        
        .bubble { max-width: 75%; padding: 12px 16px; border-radius: 16px; font-size: 15px; line-height: 1.5; position: relative; box-shadow: 0 2px 10px rgba(0,0,0,0.2); }
        .bubble img { max-width: 100%; border-radius: 10px; margin-top: 8px; display: block; border: 1px solid rgba(255,255,255,0.1); }
        .user-bubble { background: var(--user-msg); color: #fff; border-bottom-right-radius: 4px; }
        .ai-bubble { background: #1e1e1e; border: 1px solid #333; border-bottom-left-radius: 4px; }
        
        .input-area { padding: 20px; background: linear-gradient(to top, #000, transparent); }
        .input-wrap { display: flex; background: #212121; border-radius: 16px; padding: 8px 12px; border: 1px solid #333; gap: 10px; align-items: center; transition: 0.3s; }
        .input-wrap:focus-within { border-color: #555; background: #252525; }
        .input-wrap input { flex: 1; background: transparent; border: none; color: white; outline: none; font-size: 16px; padding: 8px 0; }
        
        #admin-panel { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 4000; }
        #admin-sidebar { width: 220px; border-right: 1px solid #222; overflow-y: auto; background: #0a0a0a; }
        #admin-main { flex: 1; display: flex; flex-direction: column; padding: 25px; background: #0d0d0d; }
        .chat-tab { padding: 15px; border-bottom: 1px solid #1a1a1a; cursor: pointer; font-size: 13px; color: #888; transition: 0.2s; }
        .chat-tab:hover { background: #111; color: #fff; }
        .chat-tab.active { background: #1a1a1a; color: var(--accent-color); border-left: 3px solid var(--accent-color); }
        
        .btn { background: var(--accent-color); border: none; color: #000; padding: 10px 18px; border-radius: 10px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn:hover { transform: scale(1.02); filter: brightness(1.1); }
        .attach-btn { background: none; border: none; color: #888; cursor: pointer; font-size: 22px; transition: 0.2s; padding: 0 5px; }
        .attach-btn:hover { color: #fff; }
    </style>
</head>
<body>

<div id="login-screen">
    <div class="login-box">
        <h1 style="color: var(--accent-color); margin: 0; font-size: 28px;">ExGPT</h1>
        <p style="font-size: 12px; color: #666; letter-spacing: 2px;">PREMIUM CLOUD / FREE</p>
        <input type="text" id="user-nick" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –Ω–∏–∫..." maxlength="12">
        <button class="btn" style="width:100%" onclick="initChat()">–ù–∞—á–∞—Ç—å —Å–µ—Å—Å–∏—é</button>
    </div>
</div>

<div id="app">
    <header>ExGPT 4.0 <span style="color: var(--accent-color); font-size: 10px; margin-left: 5px;">ONLINE</span></header>
    <div id="chat-window"></div>
    <div id="status" class="status-msg">GPT –ø–µ—á–∞—Ç–∞–µ—Ç...</div>
    <div class="input-area">
        <div class="input-wrap">
            <input type="file" id="file-input" style="display:none" accept="image/*" onchange="uploadImage(this)">
            <button class="attach-btn" onclick="document.getElementById('file-input').click()">üìé</button>
            <input type="text" id="user-msg-input" placeholder="–°–ø—Ä–æ—Å–∏—Ç–µ –æ —á–µ–º-–Ω–∏–±—É–¥—å...">
            <button onclick="handleUserSend()" class="btn">Go</button>
        </div>
    </div>

    <div id="admin-panel" style="display: none; flex-direction: row;">
        <div id="admin-sidebar">
            <div style="padding:20px; font-size:11px; color:gray; letter-spacing:1px;">ACTIVE_CHATS</div>
            <div id="chat-tabs-list"></div>
            <button onclick="clearCloud()" style="color:#ff4444; background:none; border:none; padding:20px; cursor:pointer; font-size:10px;">PURGE DATABASE</button>
        </div>
        <div id="admin-main">
            <div style="display:flex; justify-content:space-between; margin-bottom:20px; align-items:center;">
                <b id="active-chat-name" style="font-size:20px;">Terminal</b>
                <button onclick="closeAdmin()" class="btn" style="background:#ff4444; color:white;">EXIT</button>
            </div>
            <div id="admin-log" style="flex:1; background:#050505; border:1px solid #222; padding:15px; overflow-y:auto; margin-bottom:15px; font-family:monospace; font-size:13px;"></div>
            <div style="margin-bottom:15px; display:flex; gap:15px; align-items:center; background:#111; padding:10px; border-radius:10px;">
                –ù–∏–∫: <input type="text" id="admin-nick" value="GPT" style="width:70px; background:#000; color:white; border:1px solid #333; padding:5px;">
                –¶–≤–µ—Ç: <input type="color" id="admin-color" value="#00ff88">
                <label style="font-size:12px;"><input type="checkbox" id="is-sys"> System</label>
            </div>
            <textarea id="admin-reply-box" style="width:100%; height:80px; background:#000; color:white; border:1px solid #333; border-radius:10px; padding:12px;" placeholder="–í–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç –Ω–µ–π—Ä–æ—Å–µ—Ç–∏..."></textarea>
            <button class="btn" style="margin-top:15px; width:100%;" onclick="handleAdminReply()">–û–¢–ü–†–ê–í–ò–¢–¨ –û–¢–í–ï–¢</button>
        </div>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyAMz7N69qYWssb2KqsRAu79Km55tsJJa10",
        authDomain: "exgpttroll.firebaseapp.com",
        databaseURL: "https://exgpttroll-default-rtdb.firebaseio.com",
        projectId: "exgpttroll",
        storageBucket: "exgpttroll.firebasestorage.app",
        messagingSenderId: "957855627150",
        appId: "1:957855627150:web:2350a1345a290dd60f16df"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let currentUserName = "";
    let allChats = {};
    let selectedChat = null;

    db.ref('chats').on('value', (snap) => {
        allChats = snap.val() || {};
        renderMessages();
        renderAdminTabs();
        renderAdminLog();
    });

    function initChat() {
        const nick = document.getElementById('user-nick').value.trim();
        if(!nick) return;
        currentUserName = nick;
        document.getElementById('login-screen').style.display = 'none';
        if(!allChats[nick]) {
            sendToDB(nick, 'GPT', '–ü—Ä–∏–≤–µ—Ç! –Ø ExGPT. –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å —Å–µ–≥–æ–¥–Ω—è?', '#00ff88', false, false);
        }
    }

    function isImgUrl(url) {
        return /\.(jpg|jpeg|png|webp|avif|gif)/.test(url) || url.includes("ibb.co");
    }

    function uploadImage(input) {
        const file = input.files[0];
        if (!file) return;
        
        const formData = new FormData();
        formData.append("image", file);
        
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—ã–π —Ä–∞–±–æ—á–∏–π API –∫–ª—é—á ImgBB
        fetch("https://api.imgbb.com/1/upload?key=6d207e02198a847aa98d0a2a901485a5", {
            method: "POST",
            body: formData
        })
        .then(r => r.json())
        .then(res => {
            if (res.success) {
                let color = (currentUserName === 'Aduse17') ? '#00ff88' : '#ececec';
                sendToDB(currentUserName, currentUserName, res.data.url, color, false, true);
            } else {
                alert("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ");
            }
        });
    }

    function handleUserSend() {
        const txt = document.getElementById('user-msg-input').value.trim();
        if(!txt) return;
        if(txt === "/Sysmin10") { document.getElementById('admin-panel').style.display = 'flex'; return; }
        
        let color = (currentUserName === 'Aduse17') ? '#00ff88' : '#ececec';
        sendToDB(currentUserName, currentUserName, txt, color, false, true);
        document.getElementById('user-msg-input').value = "";
    }

    function handleAdminReply() {
        const txt = document.getElementById('admin-reply-box').value.trim();
        if(!txt || !selectedChat) return;
        const nick = document.getElementById('admin-nick').value;
        const col = document.getElementById('admin-color').value;
        const sys = document.getElementById('is-sys').checked;
        sendToDB(selectedChat, nick, txt, col, sys, false);
        document.getElementById('admin-reply-box').value = "";
    }

    function sendToDB(chat, sender, text, color, isSystem, isUser) {
        db.ref('chats/' + chat + '/messages').push({ sender, text, color, isSystem, isUser });
    }

    function renderMessages() {
        const win = document.getElementById('chat-window');
        if(!currentUserName || !allChats[currentUserName]) return;
        win.innerHTML = "";
        Object.values(allChats[currentUserName].messages).forEach(m => {
            const div = document.createElement('div');
            let isAduse = m.sender === 'Aduse17';
            div.className = 'msg-row ' + (m.isUser && !isAduse ? 'user-row' : (m.isSystem ? 'system-row' : ''));
            
            let messageContent = isImgUrl(m.text) ? `<img src="${m.text}">` : m.text;
            
            div.innerHTML = m.isSystem ? `<div style="color:${m.color}; font-size:12px; opacity:0.7;">${messageContent}</div>` : 
                `<div class="avatar" style="${(!m.isUser || isAduse) ? 'border: 1px solid '+m.color : 'background:#444'}">${m.sender[0]}</div>
                 <div class="bubble ${(m.isUser && !isAduse) ? 'user-bubble' : 'ai-bubble'}">
                    <small style="color:${m.color}; font-weight:bold; font-size:10px;">${(m.isUser && !isAduse)?'–í—ã':m.sender}</small><br>
                    ${messageContent}
                 </div>`;
            win.appendChild(div);
        });
        win.scrollTop = win.scrollHeight;
    }

    function renderAdminTabs() {
        const list = document.getElementById('chat-tabs-list');
        list.innerHTML = "";
        Object.keys(allChats).forEach(name => {
            const d = document.createElement('div');
            d.className = 'chat-tab ' + (selectedChat === name ? 'active' : '');
            d.innerText = name;
            d.onclick = () => { selectedChat = name; document.getElementById('active-chat-name').innerText = name; renderAdminTabs(); renderAdminLog(); };
            list.appendChild(d);
        });
    }

    function renderAdminLog() {
        const log = document.getElementById('admin-log');
        if(!selectedChat || !allChats[selectedChat]) return;
        log.innerHTML = "";
        Object.values(allChats[selectedChat].messages).forEach(m => {
            let line = isImgUrl(m.text) ? "[IMAGE_FILE]" : m.text;
            log.innerHTML += `<div style="color:${m.isUser?'#4dabff':m.color}; margin-bottom:5px;">[${m.sender}]: ${line}</div>`;
        });
        log.scrollTop = log.scrollHeight;
    }

    function clearCloud() { if(confirm("–í–ù–ò–ú–ê–ù–ò–ï! –≠—Ç–æ —É–¥–∞–ª–∏—Ç –≤—Å–µ –ø–µ—Ä–µ–ø–∏—Å–∫–∏. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?")) db.ref('/').remove(); }
    function closeAdmin() { document.getElementById('admin-panel').style.display = 'none'; }
</script>
</body>
</html>
